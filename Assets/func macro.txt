REM  *****  BASIC  *****

Sub ExportCSVs
	document = ThisComponent
 
	' Use the global string tools library to generate a base filename for each CSV
	' based on the current prefixless filename
	GlobalScope.BasicLibraries.loadLibrary("Tools")
	BaseFilename = Tools.Strings.GetFileNameWithoutExtension(document.getURL(), "/")
 
	' Work out number of sheets for looping over them later.	
	Sheets = document.Sheets
	NumSheets = Sheets.Count< - 1
 
	' Set up a propval object to store the filter properties
	Dim Propval(1) as New com.sun.star.beans.PropertyValue
	Propval(0).Name = "FilterName"
	Propval(0).Value = "Text - txt - csv (StarCalc)"
	Propval(1).Name = "FilterOptions"
	Propval(1).Value ="59,34,76,1,1"   'ASCII  59 = ;  34 = "
		
	For I = 0 to Sheets.Count-1
		' For each sheet, assemble a filename and save using the filter
		SheetName = Sheets(I).Name
		document.getCurrentController.setActiveSheet(Sheets(I))		
		Filename = "C:\Users\Gabriel\Documents\Bobby-Duck\Assets\Resources\" + BaseFilename + "\CSVs\" + I + " - " + SheetName + ".csv"
		FileURL = convertToURL(Filename)
		document.StoreAsURL(FileURL, Propval())

	Next I

	rem Save ODS file
 
 	dispatcher = createUnoService("com.sun.star.frame.DispatchHelper")
	
	Filename = "C:\Users\Gabriel\Documents\Bobby-Duck\Assets\Resources\" + BaseFilename + "\" + BaseFilename + ".ods"
	vURL = ConvertToURL (Filename)
	
	dim args1(1) as new com.sun.star.beans.PropertyValue
	args1(0).Name = "URL"
	args1(0).Value = vURL
	args1(1).Name = "FilterName"
	args1(1).Value = "calc8"
	
	document.StoreAsURL(vURL, args1())
 	
 
	' Libreoffice thinks our filename is now the last-exported-CSV filename, so close.


End Sub